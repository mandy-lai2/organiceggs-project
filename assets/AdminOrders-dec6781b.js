import{d as C}from"./dateMixin-70f8a72b.js";import{P as E}from"./PaginationComponent-8bf8e979.js";import{m as D}from"./modalMixin-8571d0f8.js";import{_ as v,o as r,c as i,a as t,t as o,F as M,h as w,j as B,K as P,E as S,G as b,f as x,m as T,r as f,b as O}from"./index-e19f4a21.js";import{S as k}from"./sweetalert2.all-904252d4.js";import{l as A}from"./loadingStore-c2872b6d.js";const L={props:{order:{type:Object,default(){return{}}}},data(){return{tempOrder:{},modal:""}},watch:{order(){this.tempOrder=this.order}},mixins:[D,C],methods:{}},V={class:"modal fade",id:"modal",tabindex:"-1","aria-labelledby":"modalLabel","aria-hidden":"true",ref:"modal"},I={class:"modal-dialog modal-xl"},U={class:"modal-content"},j=t("div",{class:"modal-header"},[t("h5",{class:"modal-title",id:"modalLabel"}," 訂單細節 "),t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"})],-1),W={class:"modal-body"},N={class:"row gx-5 orderTable my-3"},R={class:"col-sm-6"},G=t("h5",null,"用戶資料",-1),q={class:"table"},F=t("th",{scope:"row"},"姓名",-1),H=t("th",{scope:"row"},"Email",-1),K=t("th",{scope:"row"},"電話",-1),z=t("th",{scope:"row"},"地址",-1),J={class:"col-sm-6"},Q=t("h5",null,"訂單細節",-1),X={class:"table"},Y=t("th",{scope:"row"},"訂單編號",-1),Z=t("th",{scope:"row"},"下單時間",-1),tt=t("th",{scope:"row"},"付款時間",-1),et=t("th",{scope:"row"},"付款狀態",-1),st=t("th",{scope:"row"},"總金額",-1),ot={class:"col-12"},lt=t("h5",null,"選購商品",-1),dt={class:"table"},nt={class:"border-bottom-0"},at={class:"form-check form-switch"},rt={class:"form-check-label",for:"checkPaid"},it={class:"modal-footer"},ct=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function ht(e,s,a,c,l,p){var m,u,_,n;return r(),i("div",V,[t("div",I,[t("div",U,[j,t("div",W,[t("div",N,[t("div",R,[G,t("table",q,[t("tbody",null,[t("tr",null,[F,t("td",null,o((m=l.tempOrder.user)==null?void 0:m.name),1)]),t("tr",null,[H,t("td",null,o((u=l.tempOrder.user)==null?void 0:u.email),1)]),t("tr",null,[K,t("td",null,o((_=l.tempOrder.user)==null?void 0:_.tel),1)]),t("tr",null,[z,t("td",null,o((n=l.tempOrder.user)==null?void 0:n.address),1)])])])]),t("div",J,[Q,t("table",X,[t("tbody",null,[t("tr",null,[Y,t("td",null,o(l.tempOrder.id),1)]),t("tr",null,[Z,t("td",null,o(e.timeDate(l.tempOrder.create_at)),1)]),t("tr",null,[tt,t("td",null,o(e.timeDate(l.tempOrder.paid_date)),1)]),t("tr",null,[et,t("td",null,o(l.tempOrder.is_paid===!0?"已付款":"未付款"),1)]),t("tr",null,[st,t("td",null,o(l.tempOrder.total),1)])])])]),t("div",ot,[lt,t("table",dt,[t("tbody",null,[(r(!0),i(M,null,w(l.tempOrder.products,d=>(r(),i("tr",{key:d.id},[t("td",null,o(d.product.title),1),t("td",null,o(d.qty)+" "+o(d.product.unit),1),t("td",null,"NT$"+o(d.final_total),1)]))),128)),t("tr",null,[t("td",nt,[t("div",at,[B(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:"checkPaid","onUpdate:modelValue":s[0]||(s[0]=d=>l.tempOrder.is_paid=d)},null,512),[[P,l.tempOrder.is_paid]]),t("label",rt,o(l.tempOrder.is_paid===!0?"已付款":"未付款"),1)])])])])])])])]),t("div",it,[ct,t("button",{type:"button",class:"btn btn-primary",onClick:s[1]||(s[1]=d=>e.$emit("updatePaid",l.tempOrder))}," 確認修改 ")])])])],512)}const pt=v(L,[["render",ht]]),{VITE_API:g,VITE_APIPATH:$}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"mandyapi",BASE_URL:"/organiceggs-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},h=A(),y=S("adminOrderStore",{state:()=>({orders:[],pagination:{},isCloseModal:""}),actions:{getOrders(e=1){h.isLoading=!0,b.get(`${g}/api/${$}/admin/orders?page=${e}`).then(s=>{const{pagination:a,orders:c}=s.data;this.orders=c,this.pagination=a,h.isLoading=!1}).catch(s=>{alert(s.response.data.message),h.isLoading=!1})},updateOrder(e){h.isLoading=!0,this.isCloseModal="",b.put(`${g}/api/${$}/admin/order/${e.id}`,{data:e}).then(s=>{alert(s.data.message),this.getOrders(),this.isCloseModal="modal",h.isLoading=!1}).catch(s=>{alert(s.response.data.message),h.isLoading=!1})},delOrder(e,s){b.delete(`${g}/api/${$}/admin/order/${s}`).then(a=>{this.getOrders(),e.swalWithBootstrapButtons.fire("成功刪除",`${a.data.message}`,"success")}).catch(a=>{alert(a.response.data.message)})}}}),mt={props:{order:{type:Object,default(){return{}}}},data(){return{swalWithBootstrapButtons:null}},methods:{...x(y,["delOrder"]),openAlert(){this.swalWithBootstrapButtons.fire({title:"您確定刪除?",text:`${this.order.id}`,icon:"warning",showCancelButton:!0,confirmButtonText:"刪除",cancelButtonText:"取消",reverseButtons:!0}).then(e=>{e.isConfirmed?this.delOrder(this,this.order.id):e.dismiss===k.DismissReason.cancel&&this.swalWithBootstrapButtons.fire("未刪除"," ","error")})}},mounted(){this.swalWithBootstrapButtons=k.mixin({customClass:{confirmButton:"btn btn-success mx-2",cancelButton:"btn btn-danger mx-2"},buttonsStyling:!1})}},ut={class:"modal fade",id:"delCheckModal",tabindex:"-1","aria-labelledby":"delCheckModalLabel","aria-hidden":"true",ref:"modal"};function _t(e,s,a,c,l,p){return r(),i("div",ut,null,512)}const bt=v(mt,[["render",_t]]),ft={data(){return{tempOrder:{}}},computed:{...T(y,["orders","pagination","isCloseModal"])},components:{PaginationComponent:E,OrderModal:pt,DelOrderModal:bt},mixins:[C],watch:{isCloseModal(){this.isCloseModal==="modal"&&this.closeModal(this.isCloseModal)}},methods:{...x(y,["getOrders","updateOrder"]),OpenModal(e,s){const a=this.$refs.orderModal,c=this.$refs.delOrderModal;e==="edit"?(this.tempOrder={...s},a.openModal()):e==="del"&&(this.tempOrder={...s},this.$nextTick(()=>{c.openAlert()}))},closeModal(e){const s=this.$refs.orderModal;e==="modal"&&s.hideModal()}},mounted(){this.getOrders()}},Ot=t("div",{class:"d-flex justify-content-between"},[t("h5",null,"訂單管理")],-1),gt={class:"table-responsive-lg"},$t={class:"table align-middle"},Mt=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"購買時間"),t("th",{scope:"col"},"Email"),t("th",{scope:"col"},"購買項目"),t("th",{scope:"col"},"應付金額"),t("th",{scope:"col"},"是否付款"),t("th",{scope:"col"})])],-1),wt={scope:"row",class:"w-sm-50"},yt={scope:"row",class:"w-sm-50"},vt={class:"list-unstyled"},kt={class:"form-check form-switch"},Ct=["id","onUpdate:modelValue","onChange"],Bt=["for"],Pt={class:"text-end"},xt=["onClick"],Et=["onClick"],Dt=t("i",{class:"bi bi-trash3"},null,-1),St=[Dt];function Tt(e,s,a,c,l,p){const m=f("PaginationComponent"),u=f("OrderModal"),_=f("DelOrderModal");return r(),i("div",null,[Ot,t("div",gt,[t("table",$t,[Mt,t("tbody",null,[(r(!0),i(M,null,w(e.orders,n=>(r(),i("tr",{key:n.id},[t("th",wt,o(e.timeDate(n.create_at)),1),t("td",yt,o(n.user.email),1),t("td",null,[t("ul",vt,[(r(!0),i(M,null,w(n.products,d=>(r(),i("li",{key:d.id,class:"text-success mb-2"},o(d.product.title)+" 數量："+o(d.qty),1))),128))])]),t("td",null," NT$"+o(n.total),1),t("td",null,[t("div",kt,[B(t("input",{class:"form-check-input",type:"checkbox",role:"switch",id:`checkPaid${n.id}`,"onUpdate:modelValue":d=>n.is_paid=d,onChange:d=>e.updateOrder(n)},null,40,Ct),[[P,n.is_paid]]),t("label",{class:"form-check-label",for:`checkPaid${n.id}`},o(n.is_paid?"已付款":"未付款"),9,Bt)])]),t("td",Pt,[t("button",{type:"button",class:"btn btn-buttonbg me-3",onClick:d=>p.OpenModal("edit",n)}," 檢視 ",8,xt),t("button",{type:"button",class:"btn btn-outline-danger",onClick:d=>p.OpenModal("del",n)},St,8,Et)])]))),128))])])]),O(m,{pages:e.pagination,onEmitPages:e.getOrders},null,8,["pages","onEmitPages"]),O(u,{ref:"orderModal",order:l.tempOrder,onUpdatePaid:e.updateOrder},null,8,["order","onUpdatePaid"]),O(_,{ref:"delOrderModal",order:l.tempOrder,onGetOrders:e.getOrders},null,8,["order","onGetOrders"])])}const Wt=v(ft,[["render",Tt]]);export{Wt as default};
