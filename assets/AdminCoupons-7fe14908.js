import{d as B}from"./dateMixin-70f8a72b.js";import{P as V}from"./PaginationComponent-8bf8e979.js";import{m as D}from"./modalMixin-8571d0f8.js";import{E as T,G as M,f as y,_ as x,r as m,o as p,c,a as o,b as d,w as P,n as $,j as k,k as S,K as E,m as A,F as L,h as I,t as f}from"./index-e19f4a21.js";import{l as O}from"./loadingStore-c2872b6d.js";import{S as w}from"./sweetalert2.all-904252d4.js";const{VITE_API:b,VITE_APIPATH:C}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"mandyapi",BASE_URL:"/organiceggs-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},r=O(),g=T("adminCouponStore",{state:()=>({coupons:[],pagination:{},isCloseModal:""}),actions:{getCoupons(t=1){r.isLoading=!0,M.get(`${b}/api/${C}/admin/coupons?page=${t}`).then(e=>{const{coupons:n,pagination:i}=e.data;this.coupons=n,this.pagination=i,r.isLoading=!1}).catch(e=>{alert(e.response.data.message),r.isLoading=!1})},updateCoupon(t,e){r.isLoading=!0,this.isCloseModal="";let n="",i="";t==="new"?(n=`${b}/api/${C}/admin/coupon`,i="post"):t==="edit"&&(n=`${b}/api/${C}/admin/coupon/${e.id}`,i="put"),M[i](n,{data:e}).then(s=>{alert(s.data.message),this.getCoupons(),this.isCloseModal="modal",r.isLoading=!1}).catch(s=>{alert(s.response.data.message),r.isLoading=!1})},delCoupon(t,e){M.delete(`${b}/api/${C}/admin/coupon/${e}`).then(n=>{t.swalWithBootstrapButtons.fire("成功刪除",`${n.data.message}`,"success"),this.getCoupons()}).catch(n=>{alert(n.response.data.message)})}}}),U={props:{coupon:{type:Object,default(){return{}}}},data(){return{tempCoupon:{},tempDate:""}},mixins:[D,B],watch:{coupon(){this.tempCoupon=this.coupon,this.tempDate=this.timeDate(this.tempCoupon.due_date)},tempDate(){this.tempCoupon.due_date=this.dateToTime(this.tempDate)}},methods:{...y(g,["updateCoupon"]),confirmSend(t){this.$refs.form.validate().then(e=>{e.valid?this.updateCoupon(t.id?"edit":"new",t):alert("送出失敗")})}}},j={class:"modal fade",id:"modal",tabindex:"-1","aria-labelledby":"modalLabel","aria-hidden":"false",ref:"modal"},W={class:"modal-dialog modal-xl"},R={class:"modal-content"},q={class:"modal-header"},F={class:"modal-title",id:"modalLabel"},H={key:0},N={key:1},z=o("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),G={class:"modal-body"},K={class:"col-12"},J=o("label",{for:"inputTitle",class:"form-label"},"標題",-1),Q={class:"col-12"},X=o("label",{for:"inputCode",class:"form-label"},"優惠碼",-1),Y={class:"col-12"},Z=o("label",{for:"inputDuedate",class:"form-label"},"到期日",-1),oo={class:"col-12"},eo=o("label",{for:"inputPercent",class:"form-label"},"折扣百分比",-1),to={class:"col-12 mb-3"},so=o("label",{class:"form-check-label",for:"isEnabled"}," 是否啟用 ",-1),no={class:"modal-footer"},ao=o("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function lo(t,e,n,i,s,u){const h=m("v-field"),_=m("error-message"),v=m("v-form");return p(),c("div",j,[o("div",W,[o("div",R,[o("div",q,[o("h5",F,[s.tempCoupon.id?(p(),c("span",H,"編輯優惠券")):(p(),c("span",N,"新增優惠券"))]),z]),o("div",G,[d(v,{ref:"form",class:"row g-3 mb-3 modal-mb"},{default:P(({errors:a})=>[o("div",K,[J,d(h,{type:"text",class:$(["form-control",{"is-invalid":a.標題}]),id:"inputTitle",name:"標題",placeholder:"請輸入標題",rules:"required",modelValue:s.tempCoupon.title,"onUpdate:modelValue":e[0]||(e[0]=l=>s.tempCoupon.title=l)},null,8,["class","modelValue"]),d(_,{name:"標題",class:"invalid-feedback"})]),o("div",Q,[X,d(h,{type:"text",class:$(["form-control",{"is-invalid":a.優惠碼}]),id:"inputCode",name:"優惠碼",placeholder:"請輸入優惠碼",rules:"required",modelValue:s.tempCoupon.code,"onUpdate:modelValue":e[1]||(e[1]=l=>s.tempCoupon.code=l)},null,8,["class","modelValue"]),d(_,{name:"優惠碼",class:"invalid-feedback"})]),o("div",Y,[Z,k(o("input",{type:"date",class:"form-control",id:"inputDuedate",placeholder:"","onUpdate:modelValue":e[2]||(e[2]=l=>s.tempDate=l)},null,512),[[S,s.tempDate]])]),o("div",oo,[eo,d(h,{type:"number",min:"0",max:"100",class:$(["form-control",{"is-invalid":a.折扣百分比}]),id:"inputPercent",name:"折扣百分比",placeholder:"請輸入折扣百分比",rules:"required",modelValue:s.tempCoupon.percent,"onUpdate:modelValue":e[3]||(e[3]=l=>s.tempCoupon.percent=l)},null,8,["class","modelValue"]),d(_,{name:"折扣百分比",class:"invalid-feedback"})]),o("div",to,[k(o("input",{class:"form-check-input",type:"checkbox",id:"isEnabled","true-value":1,"false-value":0,"onUpdate:modelValue":e[4]||(e[4]=l=>s.tempCoupon.is_enabled=l)},null,512),[[E,s.tempCoupon.is_enabled]]),so])]),_:1},512)]),o("div",no,[ao,o("button",{type:"button",class:"btn btn-primary",onClick:e[5]||(e[5]=a=>u.confirmSend(s.tempCoupon))}," 確認 ")])])])],512)}const io=x(U,[["render",lo]]),po={props:{tempCoupon:{type:Object,default(){return{}}}},data(){return{swalWithBootstrapButtons:null}},methods:{...y(g,["delCoupon"]),openAlert(){this.swalWithBootstrapButtons.fire({title:"您確定刪除?",text:`${this.tempCoupon.title}`,icon:"warning",showCancelButton:!0,confirmButtonText:"刪除",cancelButtonText:"取消",reverseButtons:!0}).then(t=>{t.isConfirmed?this.delCoupon(this,this.tempCoupon.id):t.dismiss===w.DismissReason.cancel&&this.swalWithBootstrapButtons.fire("未刪除"," ","error")})}},mounted(){this.swalWithBootstrapButtons=w.mixin({customClass:{confirmButton:"btn btn-success mx-2",cancelButton:"btn btn-danger mx-2"},buttonsStyling:!1})}};function co(t,e,n,i,s,u){return p(),c("div")}const uo=x(po,[["render",co]]),ro={data(){return{tempCoupon:{}}},mixins:[B],components:{PaginationComponent:V,CouponModal:io,delCouponModal:uo},computed:{...A(g,["coupons","pagination","isCloseModal"])},watch:{isCloseModal(){this.isCloseModal==="modal"&&this.closeModal()}},methods:{...y(g,["getCoupons"]),OpenModal(t,e){const n=this.$refs.couponModal,i=this.$refs.delCouponModal;t==="new"?(this.tempCoupon={due_date:this.dateToTime(),is_enabled:1},n.openModal()):t==="edit"?(this.tempCoupon={...e},n.openModal()):t==="del"&&(this.tempCoupon={...e},this.$nextTick(()=>{i.openAlert()}))},closeModal(){this.$refs.couponModal.hideModal()}},mounted(){this.getCoupons()}},mo={class:"d-flex justify-content-between"},ho=o("h5",null,"優惠券管理",-1),_o={class:"table-responsive-lg"},fo={class:"table align-middle"},bo=o("thead",null,[o("tr",null,[o("th",{scope:"col"},"名稱"),o("th",{scope:"col"},"優惠碼"),o("th",{scope:"col"},"折扣百分比"),o("th",{scope:"col"},"到期日"),o("th",{scope:"col"},"是否啟用"),o("th",{scope:"col"})])],-1),Co={scope:"row"},go={scope:"row"},vo={scope:"row"},Mo={key:0,class:"text-adminbtn"},$o={key:1},yo={class:"text-end"},xo=["onClick"],ko=["onClick"],wo=o("i",{class:"bi bi-trash3"},null,-1),Bo=[wo];function Vo(t,e,n,i,s,u){const h=m("PaginationComponent"),_=m("CouponModal"),v=m("delCouponModal");return p(),c("div",null,[o("div",mo,[ho,o("button",{type:"button",class:"btn btn-outline-adminbtn",onClick:e[0]||(e[0]=a=>u.OpenModal("new"))}," 建立新優惠券〸 ")]),o("div",_o,[o("table",fo,[bo,o("tbody",null,[(p(!0),c(L,null,I(t.coupons,a=>(p(),c("tr",{key:a.id},[o("th",Co,f(a.title),1),o("td",go,f(a.code),1),o("td",vo,f(a.percent)+"% ",1),o("td",null,f(t.timeDate(a.due_date)),1),o("td",null,[a.is_enabled?(p(),c("span",Mo,"啟用")):(p(),c("span",$o,"未啟用"))]),o("td",yo,[o("button",{type:"button",class:"btn btn-buttonbg me-3",onClick:l=>u.OpenModal("edit",a)}," 編輯 ",8,xo),o("button",{type:"button",class:"btn btn-outline-danger",onClick:l=>u.OpenModal("del",a)},Bo,8,ko)])]))),128))])])]),d(h,{pages:t.pagination,onEmitPages:t.getCoupons},null,8,["pages","onEmitPages"]),d(_,{ref:"couponModal",coupon:s.tempCoupon},null,8,["coupon"]),d(v,{ref:"delCouponModal","temp-coupon":s.tempCoupon},null,8,["temp-coupon"])])}const Lo=x(ro,[["render",Vo]]);export{Lo as default};
