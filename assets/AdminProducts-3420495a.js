import{E as B,G as x,_ as C,o as m,c as u,a as t,j as h,k as P,f as $,r as g,b as d,w as S,n as b,K as w,F as E,h as A,m as L,t as y,d as D}from"./index-e19f4a21.js";import{l as O}from"./loadingStore-c2872b6d.js";import{P as j}from"./PaginationComponent-8bf8e979.js";import{m as H}from"./modalMixin-8571d0f8.js";import{S as T}from"./sweetalert2.all-904252d4.js";const{VITE_API:U,VITE_APIPATH:M}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"mandyapi",BASE_URL:"/organiceggs-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},f=O(),k=B("adminProductStore",{state:()=>({products:[],pagination:{},isCloseModal:""}),actions:{getPageProducts(s=1){f.isLoading=!0,x.get(`${U}/api/${M}/admin/products?page=${s}`).then(e=>{const{products:i,pagination:n}=e.data;this.products=i,this.pagination=n,f.isLoading=!1}).catch(e=>{alert(e.response.data.message),f.isLoading=!1})},updateProduct(s,e){f.isLoading=!0,this.isCloseModal="";let i="",n="";s==="new"?(i=`${U}/api/${M}/admin/product`,n="post"):s==="edit"&&(i=`${U}/api/${M}/admin/product/${e.id}`,n="put"),x[n](i,{data:e}).then(o=>{f.isLoading=!1,alert(o.data.message),this.getPageProducts(),this.isCloseModal="modal"}).catch(o=>{alert(o.response.data.message),console.log(o.response.data),f.isLoading=!1})},delProduct(s,e){x.delete(`${U}/api/${M}/admin/product/${e}`).then(i=>{s.swalWithBootstrapButtons.fire("成功刪除",`${i.data.message}`,"success"),this.getPageProducts()}).catch(i=>{alert(i.response.data.message)})}}}),R="/organiceggs-project/assets/imgUpload-006d82e3.png",{VITE_API:F,VITE_APIPATH:q}={VITE_API:"https://vue3-course-api.hexschool.io/v2",VITE_APIPATH:"mandyapi",BASE_URL:"/organiceggs-project/",MODE:"production",DEV:!1,PROD:!0,SSR:!1},N={data(){return{imgUrl:"",inputImg:""}},methods:{imgUpload(s){const e=s.target.files[0],i=new FormData;i.append("file-to-upload",e),this.$http.post(`${F}/api/${q}/admin/upload`,i).then(n=>{alert(`${n.data.success?"圖片上傳成功":"失敗"}`),this.imgUrl=n.data.imageUrl,this.inputImg=""}).catch(n=>{console.log(n.response.data.message)})},copyLike(){this.imgUrl&&(navigator.clipboard.writeText(this.imgUrl),alert("已複製"))}}},W={class:"container"},G=t("h5",null,"圖片上傳",-1),z={class:"mb-2"},K=["value"],J=t("label",{class:"form-label cursor-pointer",for:"formFile"},[t("img",{src:R,class:"img-fluid"})],-1),Q={class:"mb-3"},X=t("label",{class:"form-label"},"圖片連結👇",-1);function Y(s,e,i,n,o,a){return m(),u("div",W,[G,t("div",z,[t("input",{class:"form-control customFileInput",type:"file",id:"formFile",onChange:e[0]||(e[0]=(...c)=>a.imgUpload&&a.imgUpload(...c)),value:o.inputImg},null,40,K),J]),t("div",Q,[X,t("i",{class:"bi bi-stickies float-end cursor-pointer",onClick:e[1]||(e[1]=(...c)=>a.copyLike&&a.copyLike(...c)),"data-bs-toggle":"tooltip","data-bs-title":"點擊複製"}),h(t("textarea",{class:"form-control",rows:"5","onUpdate:modelValue":e[2]||(e[2]=c=>o.imgUrl=c)},null,512),[[P,o.imgUrl]])])])}const Z=C(N,[["render",Y]]),tt={props:{product:{type:Object,default(){return{}}}},data(){return{tempProduct:{}}},components:{ImgUpload:Z},mixins:[H],watch:{product(){this.tempProduct=this.product}},methods:{...$(k,["updateProduct"]),addImage(){this.tempProduct.imagesUrl?this.tempProduct.imagesUrl.push(""):this.tempProduct.imagesUrl=[""]},removeImage(s){this.tempProduct.imagesUrl.splice(s,1)},confirmSend(s){this.$refs.form.validate().then(e=>{e.valid?this.updateProduct(s.id?"edit":"new",this.tempProduct):alert("送出失敗")})}}},et={class:"modal fade",id:"modal",tabindex:"-1","aria-labelledby":"modalLabel","aria-hidden":"false",ref:"modal"},ot={class:"modal-dialog modal-xl"},st={class:"modal-content"},lt={class:"modal-header"},it={class:"modal-title",id:"modalLabel"},nt={key:0},at={key:1},dt=t("button",{type:"button",class:"btn-close","data-bs-dismiss":"modal","aria-label":"Close"},null,-1),ct={class:"modal-body"},rt={class:"col-md-8"},mt={class:"row modal-mb"},ut={class:"col-12"},pt=t("label",{for:"inputTitle",class:"form-label"},"標題",-1),_t={class:"col-md-6"},ht=t("label",{for:"inputCategory",class:"form-label"},"分類",-1),gt={class:"col-md-6"},ft=t("label",{for:"inputUnit",class:"form-label"},"單位",-1),bt={class:"col-md-6"},Pt=t("label",{for:"inputOriginPrice",class:"form-label"},"原價",-1),vt={class:"col-md-6"},yt=t("label",{for:"inputPrice",class:"form-label"},"售價",-1),Ut={class:"col-12"},Mt=t("label",{for:"description",class:"form-label"},"產品描述",-1),kt={class:"col-12"},Ct=t("label",{for:"productContent",class:"form-label"},"說明內容",-1),Vt={class:"col-12 mb-3"},xt=t("label",{class:"form-check-label",for:"isEnabled"}," 是否啟用 ",-1),$t=t("label",{class:"form-check-label",for:"isHotProduct"}," 是否人氣商品 ",-1),It={class:"col-md-4"},wt=t("label",{for:"mainImage",class:"form-label"},"主要圖片",-1),Tt=["src"],Et=t("div",{class:"text-secondary"},[t("hr")],-1),At=t("div",{class:"text-secondary"},[t("hr")],-1),Bt={class:"col-12"},St=t("h5",{class:"mt-2 d-inline-block me-2"},"多圖新增",-1),Lt={class:"row g-5"},Dt=t("label",{for:"imageUrl",class:"form-label mt-3"},"圖片網址",-1),Ot=["onUpdate:modelValue"],jt=["src"],Ht=["onClick"],Rt={class:"modal-footer"},Ft=t("button",{type:"button",class:"btn btn-secondary","data-bs-dismiss":"modal"}," 取消 ",-1);function qt(s,e,i,n,o,a){const c=g("v-field"),_=g("error-message"),V=g("ImgUpload"),r=g("v-form");return m(),u("div",et,[t("div",ot,[t("div",st,[t("div",lt,[t("h5",it,[o.tempProduct.id?(m(),u("span",nt,"編輯產品")):(m(),u("span",at,"新增產品"))]),dt]),t("div",ct,[d(r,{ref:"form",class:"row g-3 mb-3"},{default:S(({errors:p})=>[t("div",rt,[t("div",mt,[t("div",ut,[pt,d(c,{type:"text",class:b(["form-control",{"is-invalid":p.標題}]),id:"inputTitle",name:"標題",placeholder:"請輸入標題",rules:"required",modelValue:o.tempProduct.title,"onUpdate:modelValue":e[0]||(e[0]=l=>o.tempProduct.title=l)},null,8,["class","modelValue"]),d(_,{name:"標題",class:"invalid-feedback"})]),t("div",_t,[ht,d(c,{type:"text",class:b(["form-control",{"is-invalid":p.分類}]),id:"inputCategory",name:"分類",placeholder:"請輸入分類",rules:"required",modelValue:o.tempProduct.category,"onUpdate:modelValue":e[1]||(e[1]=l=>o.tempProduct.category=l)},null,8,["class","modelValue"]),d(_,{name:"分類",class:"invalid-feedback"})]),t("div",gt,[ft,d(c,{type:"text",class:b(["form-control",{"is-invalid":p.分類}]),id:"inputCategory",name:"分類",placeholder:"請輸入分類",rules:"required",modelValue:o.tempProduct.category,"onUpdate:modelValue":e[2]||(e[2]=l=>o.tempProduct.category=l)},null,8,["class","modelValue"]),d(_,{name:"分類",class:"invalid-feedback"})]),t("div",bt,[Pt,d(c,{type:"number",min:"0",class:b(["form-control",{"is-invalid":p.原價}]),id:"inputOriginPrice",name:"原價",placeholder:"請輸入原價",rules:"required",modelValue:o.tempProduct.origin_price,"onUpdate:modelValue":e[3]||(e[3]=l=>o.tempProduct.origin_price=l),modelModifiers:{number:!0}},null,8,["class","modelValue"]),d(_,{name:"原價",class:"invalid-feedback"})]),t("div",vt,[yt,d(c,{type:"number",min:"0",class:b(["form-control",{"is-invalid":p.售價}]),id:"inputPrice",name:"售價",placeholder:"請輸入售價",modelValue:o.tempProduct.price,"onUpdate:modelValue":e[4]||(e[4]=l=>o.tempProduct.price=l),modelModifiers:{number:!0},rules:"required"},null,8,["class","modelValue"]),d(_,{name:"售價",class:"invalid-feedback"})]),t("div",Ut,[Mt,h(t("textarea",{class:"form-control",id:"description",rows:"3",placeholder:"請輸入產品描述","onUpdate:modelValue":e[5]||(e[5]=l=>o.tempProduct.description=l)},null,512),[[P,o.tempProduct.description]])]),t("div",kt,[Ct,h(t("textarea",{class:"form-control",id:"productContent",rows:"3",placeholder:"請輸入說明內容","onUpdate:modelValue":e[6]||(e[6]=l=>o.tempProduct.content=l)},null,512),[[P,o.tempProduct.content]])]),t("div",Vt,[h(t("input",{class:"form-check-input",type:"checkbox",id:"isEnabled","onUpdate:modelValue":e[7]||(e[7]=l=>o.tempProduct.is_enabled=l)},null,512),[[w,o.tempProduct.is_enabled]]),xt,h(t("input",{class:"form-check-input",type:"checkbox",id:"isHotProduct","onUpdate:modelValue":e[8]||(e[8]=l=>o.tempProduct.is_hot=l)},null,512),[[w,o.tempProduct.is_hot]]),$t])])]),t("div",It,[wt,h(t("input",{type:"text",class:"form-control",id:"mainImage",placeholder:"請輸入圖片連結","onUpdate:modelValue":e[9]||(e[9]=l=>o.tempProduct.imageUrl=l)},null,512),[[P,o.tempProduct.imageUrl]]),t("img",{class:"img-fluid",src:o.tempProduct.imageUrl,alt:"圖片"},null,8,Tt),Et,d(V)]),At,t("div",Bt,[St,t("button",{type:"button",class:"btn btn-outline-primary",onClick:e[10]||(e[10]=(...l)=>a.addImage&&a.addImage(...l))}," 新增圖片 "),t("div",Lt,[(m(!0),u(E,null,A(o.tempProduct.imagesUrl,(l,v)=>(m(),u("div",{class:"col-4",key:v},[Dt,h(t("input",{type:"text",class:"form-control",placeholder:"請輸入圖片連結","onUpdate:modelValue":I=>o.tempProduct.imagesUrl[v]=I},null,8,Ot),[[P,o.tempProduct.imagesUrl[v]]]),t("img",{class:"img-fluid",src:l,alt:"圖片"},null,8,jt),t("button",{type:"button",class:"btn btn-outline-danger w-100 mt-2",onClick:I=>a.removeImage(v)}," 刪除 ",8,Ht)]))),128))])])]),_:1},512)]),t("div",Rt,[Ft,t("button",{type:"button",class:"btn btn-primary",onClick:e[11]||(e[11]=p=>a.confirmSend(o.tempProduct))}," 確認 ")])])])],512)}const Nt=C(tt,[["render",qt]]),Wt={props:{tempProduct:{type:Object,default(){return{}}}},data(){return{swalWithBootstrapButtons:null}},methods:{...$(k,["delProduct"]),openAlert(){this.swalWithBootstrapButtons.fire({title:"您確定刪除?",text:`${this.tempProduct.title}`,icon:"warning",showCancelButton:!0,confirmButtonText:"刪除",cancelButtonText:"取消",reverseButtons:!0}).then(s=>{s.isConfirmed?this.delProduct(this,this.tempProduct.id):s.dismiss===T.DismissReason.cancel&&this.swalWithBootstrapButtons.fire("未刪除"," ","error")})}},mounted(){this.swalWithBootstrapButtons=T.mixin({customClass:{confirmButton:"btn btn-success mx-2",cancelButton:"btn btn-danger mx-2"},buttonsStyling:!1})}},Gt={class:"modal fade",id:"delCheckModal",tabindex:"-1","aria-labelledby":"delCheckModalLabel","aria-hidden":"true",ref:"modal"},zt=t("div",{class:"modal-dialog modal-xl"},null,-1),Kt=[zt];function Jt(s,e,i,n,o,a){return m(),u("div",Gt,Kt,512)}const Qt=C(Wt,[["render",Jt]]),Xt={data(){return{tempProduct:{}}},components:{PaginationComponent:j,ProductModal:Nt,DelProductModal:Qt},computed:{...L(k,["products","pagination","isCloseModal"])},watch:{isCloseModal(){this.isCloseModal==="modal"&&this.closeModal(this.isCloseModal)}},methods:{...$(k,["getPageProducts"]),OpenModal(s,e){const i=this.$refs.productModal,n=this.$refs.delProductModal;s==="new"?(this.tempProduct={imagesUrl:[]},i.openModal()):s==="edit"?(this.tempProduct={...e},i.openModal()):s==="del"&&(this.tempProduct={...e},this.$nextTick(()=>{n.openAlert()}))},closeModal(s){const e=this.$refs.productModal;s==="modal"&&e.hideModal()}},mounted(){this.getPageProducts()}},Yt={class:"d-flex justify-content-between"},Zt=t("h5",null,"產品管理",-1),te={class:"table-responsive-lg"},ee={class:"table align-middle"},oe=t("thead",null,[t("tr",null,[t("th",{scope:"col"},"分類"),t("th",{scope:"col"},"產品名稱"),t("th",{scope:"col"},"原價"),t("th",{scope:"col"},"售價"),t("th",{scope:"col"},"是否啟用"),t("th",{scope:"col"})])],-1),se={scope:"row",class:"w-sm-50"},le={scope:"row",class:"w-sm-50"},ie=["src"],ne={key:0,class:"text-adminbtn"},ae={key:1},de={class:"text-end"},ce=["onClick"],re=["onClick"],me=t("i",{class:"bi bi-trash3"},null,-1),ue=[me];function pe(s,e,i,n,o,a){const c=g("PaginationComponent"),_=g("ProductModal"),V=g("DelProductModal");return m(),u("div",null,[t("div",Yt,[Zt,t("button",{type:"button",class:"btn btn-outline-adminbtn",onClick:e[0]||(e[0]=r=>a.OpenModal("new"))}," 建立新的產品〸 ")]),t("div",te,[t("table",ee,[oe,t("tbody",null,[(m(!0),u(E,null,A(s.products,r=>(m(),u("tr",{key:r.id},[t("th",se,y(r.category),1),t("td",le,[t("img",{class:"max-width-130 w-100",src:r.imageUrl,alt:""},null,8,ie),D(" "+y(r.title),1)]),t("td",null," NT$"+y(r.origin_price),1),t("td",null," NT$"+y(r.price),1),t("td",null,[r.is_enabled?(m(),u("span",ne,"啟用")):(m(),u("span",ae,"未啟用"))]),t("td",de,[t("button",{type:"button",class:"btn btn-buttonbg me-3",onClick:p=>a.OpenModal("edit",r)}," 編輯 ",8,ce),t("button",{type:"button",class:"btn btn-outline-danger",onClick:p=>a.OpenModal("del",r)},ue,8,re)])]))),128))])])]),d(c,{pages:s.pagination,onEmitPages:s.getPageProducts},null,8,["pages","onEmitPages"]),d(_,{ref:"productModal",product:o.tempProduct},null,8,["product"]),d(V,{ref:"delProductModal","temp-product":o.tempProduct,onGetProducts:s.getPageProducts,onCloseModal:a.closeModal},null,8,["temp-product","onGetProducts","onCloseModal"])])}const Pe=C(Xt,[["render",pe]]);export{Pe as default};
